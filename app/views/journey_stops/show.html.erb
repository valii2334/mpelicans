<div class="row"> 
  <div class="col-lg-6 offset-lg-3 col-md-8 offset-md-2 col-12">
    <% if @journey_stop.journey.protected_journey? %>
      <% if current_user && can?(:edit, @journey_stop.journey) %>
        <%= link_to 'View Journey', journey_path(@journey_stop.journey), class: 'btn btn-primary float-end mt-n1' %>
      <% else %>
        <%= link_to 'View Journey', watch_journey_url(access_code: @journey_stop.journey.access_code), class: 'btn btn-primary float-end mt-n1' %>
      <% end %>
    <% else %>
      <%= link_to 'View Journey', journey_path(@journey_stop.journey), class: 'btn btn-primary float-end mt-n1' %>
    <% end %>
  </div>
</div>

<div class="row"> 
  <div class="col-lg-6 offset-lg-3 col-md-8 offset-md-2 col-12">
    <h1 id="journey-stop-title"><%= @journey_stop.title %></h1>
  </div>
</div>

<% if @journey_stop.description.body %>
  <div class="row">
    <div class="col-lg-6 offset-lg-3 col-md-8 offset-md-2 col-12">
      <div class="card">
        <div class="card-body">
          <div id="journey-stop-description">
            <%= @journey_stop.description %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

<% unless Rails.env.test? %>
  <%= render partial: 'shared/map', locals: { pins: [@journey_stop.pin].to_json } %>
<% end %>

<% if @journey_stop.waiting? %>
  <%= render partial: 'shared/processing_images', locals: { message: 'Please wait. Images have been scheduled for processing.' } %>
<% elsif @journey_stop.processing? %>
  <%= render partial: 'shared/processing_images', locals: { message: 'Please wait. Images are being processed.' } %>
<% else %>
  <div class="row" data-controller="lightbox">
    <div class="col-lg-6 offset-lg-3 col-md-8 offset-md-2 col-12">
      <% @journey_stop.images.each_with_index do |image, index| %>
        <div class="col-6">
          <a href="<%= image.variant(:max).processed.url %>" data-gallery="example-gallery" class="lightbox-image">
            <img src="<%= image.variant(:thumbnail).processed.url %>" class="img-thumbnail rounded me-2 mb-2" id="journey-stop-image-<%= index %>">
          </a>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<div class="row"> 
  <div class="col-lg-6 offset-lg-3 col-md-8 offset-md-2 col-12">
    <% if current_user && can?(:destroy, @journey_stop) %>
      <%= link_to 'Delete Stop', journey_journey_stop_path(@journey_stop.journey, @journey_stop), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger float-end mt-n1' %>
    <% end %>
  </div>
</div>